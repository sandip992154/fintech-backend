import React, { useState, useEffect } from 'react';\nimport { toast } from 'react-hot-toast';\nimport { apiService } from '../services/api';\n\nconst ComparisonTest = () => {\n  const [testResults, setTestResults] = useState({});\n  const [loading, setLoading] = useState(false);\n  const [sampleProducts, setSampleProducts] = useState([]);\n\n  const runComparisonTests = async () => {\n    setLoading(true);\n    const results = {};\n    \n    try {\n      // Test 1: Fetch sample products for testing\n      console.log('üß™ Test 1: Fetching sample products...');\n      const searchResponse = await apiService.searchProducts({ \n        limit: 10, \n        category: 'mobiles' \n      });\n      \n      const products = searchResponse.data.products || [];\n      setSampleProducts(products);\n      \n      results.sampleProducts = {\n        status: products.length > 0 ? 'PASS' : 'FAIL',\n        count: products.length,\n        details: `Found ${products.length} products for testing`\n      };\n\n      if (products.length >= 2) {\n        // Test 2: Single Product Comparison API\n        console.log('üß™ Test 2: Testing single product comparison...');\n        const sampleProductIds = products.slice(0, 4).map(p => p._id || p.id);\n        \n        try {\n          const comparisonResponse = await apiService.getComparisonProducts(sampleProductIds);\n          const comparisonData = comparisonResponse.data;\n          \n          results.batchComparison = {\n            status: comparisonData.products ? 'PASS' : 'FAIL',\n            count: comparisonData.products?.length || 0,\n            comparisonReady: comparisonData.comparison_ready || false,\n            details: `Batch API returned ${comparisonData.products?.length || 0} products`\n          };\n        } catch (batchError) {\n          results.batchComparison = {\n            status: 'FAIL',\n            error: batchError.message,\n            details: 'Batch comparison API failed'\n          };\n        }\n\n        // Test 3: Price Analysis\n        console.log('üß™ Test 3: Testing price analysis...');\n        const firstProduct = products[0];\n        \n        try {\n          const priceResponse = await apiService.getPriceAnalysis(firstProduct._id || firstProduct.id);\n          const priceData = priceResponse.data;\n          \n          results.priceAnalysis = {\n            status: priceData.vendor_analysis ? 'PASS' : 'FAIL',\n            vendorCount: Object.keys(priceData.vendor_analysis || {}).length,\n            maxSavings: priceData.price_statistics?.max_savings_percent,\n            details: `Price analysis for ${priceData.product_title}\"\n          };\n        } catch (priceError) {\n          results.priceAnalysis = {\n            status: 'FAIL',\n            error: priceError.message,\n            details: 'Price analysis API failed'\n          };\n        }\n\n        // Test 4: Suggestion Engine\n        console.log('üß™ Test 4: Testing suggestion engine...');\n        try {\n          const suggestionResponse = await apiService.getSuggestedComparisons({\n            category: 'mobiles',\n            price_range: 'medium',\n            limit: 4\n          });\n          \n          const suggestions = suggestionResponse.data.suggested_products || [];\n          \n          results.suggestions = {\n            status: suggestions.length > 0 ? 'PASS' : 'FAIL',\n            count: suggestions.length,\n            details: `Suggestion engine returned ${suggestions.length} products`\n          };\n        } catch (suggestionError) {\n          results.suggestions = {\n            status: 'FAIL',\n            error: suggestionError.message,\n            details: 'Suggestion API failed'\n          };\n        }\n\n        // Test 5: Data Quality Check\n        console.log('üß™ Test 5: Checking data quality...');\n        const qualityStats = {\n          withVendors: 0,\n          withPricing: 0,\n          withImages: 0,\n          totalVendors: new Set()\n        };\n        \n        products.forEach(product => {\n          if (product.vendors && Object.keys(product.vendors).length > 0) {\n            qualityStats.withVendors++;\n            \n            Object.keys(product.vendors).forEach(vendor => {\n              qualityStats.totalVendors.add(vendor);\n              \n              const vendorData = product.vendors[vendor];\n              if (vendorData.price || vendorData.discountprice) {\n                qualityStats.withPricing++;\n              }\n            });\n          }\n          \n          if (product.image || product.images) {\n            qualityStats.withImages++;\n          }\n        });\n        \n        const qualityScore = (\n          (qualityStats.withVendors / products.length) * 30 +\n          (qualityStats.withPricing / (products.length * 2)) * 40 + // Assuming avg 2 vendors per product\n          (qualityStats.withImages / products.length) * 20 +\n          (Math.min(qualityStats.totalVendors.size, 5) / 5) * 10\n        );\n        \n        results.dataQuality = {\n          status: qualityScore >= 70 ? 'PASS' : qualityScore >= 50 ? 'WARN' : 'FAIL',\n          score: Math.round(qualityScore),\n          vendorCoverage: qualityStats.withVendors,\n          pricingCoverage: qualityStats.withPricing,\n          imageCoverage: qualityStats.withImages,\n          totalVendors: qualityStats.totalVendors.size,\n          details: `Quality score: ${Math.round(qualityScore)}/100`\n        };\n      }\n      \n    } catch (error) {\n      console.error('Test suite failed:', error);\n      toast.error('Comparison tests failed');\n    }\n    \n    setTestResults(results);\n    setLoading(false);\n    \n    // Show summary toast\n    const passCount = Object.values(results).filter(r => r.status === 'PASS').length;\n    const totalTests = Object.keys(results).length;\n    \n    if (passCount === totalTests) {\n      toast.success(`All ${totalTests} comparison tests passed! üéâ`);\n    } else {\n      toast.warn(`${passCount}/${totalTests} tests passed. Check results below.`);\n    }\n  };\n\n  const getStatusColor = (status) => {\n    switch(status) {\n      case 'PASS': return 'text-green-600 bg-green-100';\n      case 'WARN': return 'text-yellow-600 bg-yellow-100';\n      case 'FAIL': return 'text-red-600 bg-red-100';\n      default: return 'text-gray-600 bg-gray-100';\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6\">\n      <div className=\"bg-white rounded-lg shadow-lg p-6\">\n        <h2 className=\"text-2xl font-bold mb-6 text-gray-800\">\n          üß™ Comparison System Test Suite\n        </h2>\n        \n        <div className=\"mb-6\">\n          <button\n            onClick={runComparisonTests}\n            disabled={loading}\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg disabled:opacity-50 transition-colors\"\n          >\n            {loading ? 'üîÑ Running Tests...' : '‚ñ∂Ô∏è Run Comparison Tests'}\n          </button>\n        </div>\n\n        {Object.keys(testResults).length > 0 && (\n          <div className=\"space-y-4\">\n            <h3 className=\"text-lg font-semibold mb-4\">Test Results</h3>\n            \n            {Object.entries(testResults).map(([testName, result]) => (\n              <div key={testName} className=\"border rounded-lg p-4\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <h4 className=\"font-medium capitalize\">\n                    {testName.replace(/([A-Z])/g, ' $1').trim()}\n                  </h4>\n                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${\n                    getStatusColor(result.status)\n                  }`}>\n                    {result.status}\n                  </span>\n                </div>\n                \n                <p className=\"text-gray-600 text-sm mb-2\">{result.details}</p>\n                \n                {result.count !== undefined && (\n                  <p className=\"text-sm text-gray-500\">Count: {result.count}</p>\n                )}\n                \n                {result.score !== undefined && (\n                  <p className=\"text-sm text-gray-500\">Score: {result.score}/100</p>\n                )}\n                \n                {result.error && (\n                  <p className=\"text-red-500 text-sm mt-1\">Error: {result.error}</p>\n                )}\n              </div>\n            ))}\n          </div>\n        )}\n        \n        {sampleProducts.length > 0 && (\n          <div className=\"mt-8\">\n            <h3 className=\"text-lg font-semibold mb-4\">Sample Products for Testing</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {sampleProducts.slice(0, 4).map((product, index) => (\n                <div key={index} className=\"border rounded-lg p-3\">\n                  <h4 className=\"font-medium text-sm\">\n                    {product.title?.substring(0, 50)}...\n                  </h4>\n                  <p className=\"text-gray-600 text-xs mt-1\">\n                    Vendors: {Object.keys(product.vendors || {}).join(', ')}\n                  </p>\n                  <p className=\"text-gray-500 text-xs\">\n                    ID: {product._id || product.id}\n                  </p>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ComparisonTest;